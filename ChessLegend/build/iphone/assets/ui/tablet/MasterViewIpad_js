function MasterView(e,t){var s=Ti.UI.createView({width:e,height:t,top:0,backgroundImage:Ti.Filesystem.resourcesDirectory+"images/masterback.png",borderWidth:0,borderColor:"transparent"}),i=getInitData(),a=Ti.UI.createTableView({data:i,left:5,top:50,width:e-10,height:t-70,rowHeight:40,backgroundColor:"transparent",separatorColor:"transparent"});s.add(a),s.table=a,a.addEventListener("click",function(e){Ti.API.log("*** master table click"+e+e.row.index),s.fireEvent("opengame",{name:e.row.title,game:e.row.index})}),s.addEventListener("display",function(){s.table.setData(getInitData()),s.table.setIndex([]);var e=getTableData(null);s.table.setData(e.tableData),s.table.setIndex(e.index),myChess.chessObj.PlayerList=e});var r=Ti.UI.createButton({top:30,left:20,width:90,height:48,backgroundImage:null});r.addEventListener("click",function(){s.fireEvent("backToList")});var o=Ti.UI.createButton({top:30,left:160,width:90,height:48,backgroundImage:null});o.addEventListener("click",function(){s.fireEvent("showIntro")}),s.add(r);var n=Titanium.UI.createSearchBar({backgroundImage:Ti.Filesystem.resourcesDirectory+"images/searchBar.png",barColor:"transparent",showCancel:!0,width:e-6,height:45,left:3,top:2});return n.addEventListener("cancel",function(){Titanium.API.info("search bar cancel fired"),a.setData(myChess.chessObj.PlayerList.tableData),a.setIndex(myChess.chessObj.PlayerList.index),n.blur()}),n.addEventListener("return",function(e){var t=getTableData(e.value);s.table.setData(t.tableData),s.table.setIndex(t.index),n.blur()}),s.add(n),s}function getRowData(e){var t=myChess.Games[myChess.PlayerIndex].games[e],s=myChess.Players[myChess.PlayerIndex][6],i=t.White,a="white";-1!=i.indexOf(s)&&(i=t.Black,a="#331122");var r=t.Result;r.indexOf("1/2")&&(r="1/2"),i=i+" ("+t.Result+")";var o=Ti.UI.createTableViewRow({backgroundImage:Ti.Filesystem.resourcesDirectory+"images/babooItem.png",index:e,height:32,borderWidth:0,className:"game"}),n="";"?"!=t.Event?n=t.Event:"?"!=t.Site&&(n=t.Site);var h=Ti.UI.createLabel({text:t.Year,textAlign:"left",height:12,width:50,font:{fontSize:13,fontWeight:"normal",fontFamily:"Arial"},color:"#113322",top:2,left:10}),c=Ti.UI.createLabel({text:n,textAlign:"right",height:12,width:180,font:{fontSize:13,fontWeight:"normal",fontFamily:"Arial"},color:"#112233",top:2,right:10}),d=Ti.UI.createLabel({text:i,textAlign:"bottom",height:20,width:238,color:a,bottom:6,left:20});return o.add(h),o.add(c),o.add(d),o.year=t.Year,o}function getTableData(e){var t=myChess.Games[myChess.PlayerIndex].Years,s=[];for(i=0;i<myChess.Games[myChess.PlayerIndex].games.length;i++)if(query(e,i)){var a=getRowData(i);if(!s[a.year]){{var r=Ti.UI.createTableViewSection({index:i,count:0});Ti.UI.createView({height:1})}s[a.year]=r}s[a.year].add(a),s[a.year].count++}var o=s,n=[],h=0;for(i=0;i<t.length;i++)s[t[i]]&&(n.push({title:t[i],index:h}),h+=s[t[i]].count);return data={tableData:o,index:n}}function query(e,t){if(null==e||0==e.length)return!0;e=e.toLowerCase().replace(","," ").replace(";"," ");var s=myChess.Games[myChess.PlayerIndex].games[t],i=s.White,a=s.Black,r=s.Site,o=s.Year,n=s.Date,h=s.Event,c=s.ECO,d=i+" "+a;r&&(d+=" "+r),o&&(d+=" "+o),n&&(d+=" "+n),h&&(d+=" "+h),c&&(d+=" "+c),d=d.replace("?"," ").replace(","," "),d=d.toLowerCase();var l=e.split(" ");for(si=0;si<l.length;si++){var m=l[si];if(-1==d.indexOf(m))return!1}return!0}function getInitData(){var e=[];for(li=0;9>li;li++){var t=Ti.UI.createTableViewRow({backgroundColor:"#transparent",title:" ",font:{fontSize:18,fontWeight:"bold",fontFamily:"Arial"},color:"black"});e.push(t)}return e[5].title=" ... Loading game list ...",e}module.exports=MasterView;