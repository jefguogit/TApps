function MasterView(e,s){var t=Ti.UI.createView({width:e,height:s,backgroundImage:Ti.Filesystem.resourcesDirectory+"images/masterbackh.png"}),i=Ti.UI.createView({top:0,left:0,width:e,height:50});t.add(i);var a=getInitData(),r=Ti.UI.createTableView({data:a,left:8,top:53,width:e-6,height:s-60,rowHeight:30,backgroundColor:"transparent",separatorColor:"transparent"});r.addEventListener("click",function(e){myChess.chessObj.gameIndex=e.row.index,myChess.tabGroup.fireEvent("showGame")}),t.add(r),t.table=r,myChess.chessObj.gameTable=r,t.addEventListener("display",function(e){Ti.API.info(myChess.PlayerIndex+"  "+e.index),t.table.setData(getInitData()),t.table.setIndex([]);var s=getTableData(null);Ti.API.info("tabDat:"+s),t.table.setData(s.tableData),t.table.setIndex(s.index),myChess.chessObj.PlayerList=s});var n=Ti.UI.createButton({top:2,left:10,width:90,height:30,backgroundImage:null});n.addEventListener("click",function(){h.blur(),h.top=-100,h.fireEvent("cancel"),myChess.tabGroup.fireEvent("showPlayer")});var o=Ti.UI.createButton({top:2,right:0,width:40,height:52,backgroundImage:null});o.addEventListener("click",function(){h.top=45,t.sb.focus(),r.top=93}),t.add(n),t.add(o);var h=(myChess.Players[myChess.PlayerIndex],Titanium.UI.createSearchBar({backgroundImage:Ti.Filesystem.resourcesDirectory+"images/searchBar.png",barColor:"transparent",showCancel:!0,size:20,height:40,top:-100}));h.addEventListener("cancel",function(){Titanium.API.info("search bar cancel fired"),r.setData(myChess.chessObj.PlayerList.tableData),r.setIndex(myChess.chessObj.PlayerList.index),h.blur(),h.top=-100,r.top=53});var c=Ti.UI.createButton({width:70,height:40,right:2,backgroundImage:null});return c.addEventListener("click",function(){h.fireEvent("cancel")}),h.add(c),h.addEventListener("return",function(e){var s=getTableData(e.value);t.table.setData(s.tableData),t.table.setIndex(s.index),h.blur()}),t.add(h),t.sb=h,t}function getRowData(e){var s=myChess.Games[myChess.PlayerIndex].games[e],t=myChess.Players[myChess.PlayerIndex][6],i=s.White,a="white";-1!=i.indexOf(t)&&(i=s.Black,a="#331122");var r=s.Result;-1==r.indexOf("0")&&(r="1/2"),r="("+r+")";var n=Ti.UI.createTableViewRow({backgroundImage:Ti.Filesystem.resourcesDirectory+"images/babooItemh.png",height:39,borderWidth:0,index:e,className:"game"}),o="";"?"!=s.Event?o=s.Event:"?"!=s.Site&&(o=s.Site);var h=Ti.UI.createLabel({text:s.Year,textAlign:"left",height:12,width:50,font:{fontSize:13,fontWeight:"normal",fontFamily:"Arial"},color:"#113322",top:2,left:10}),c=Ti.UI.createLabel({text:r,textAlign:"left",height:12,width:50,font:{fontSize:13,fontWeight:"normal",fontFamily:"Arial"},color:"#113322",top:2,left:80}),d=Ti.UI.createLabel({text:o,textAlign:"right",height:12,width:180,font:{fontSize:13,fontWeight:"normal",fontFamily:"Arial"},color:"#112233",top:2,right:15}),b=Ti.UI.createLabel({text:i,textAlign:"bottom",height:30,width:238,font:{fontSize:15,fontWeight:"normal",fontFamily:"Arial"},color:a,bottom:1,left:20});return n.add(h),n.add(c),n.add(d),n.add(b),n.year=s.Year,n}function getTableData(e){Ti.API.info("index:"+myChess.PlayerIndex);var s=myChess.Games[myChess.PlayerIndex].Years,t=[];for(i=0;i<myChess.Games[myChess.PlayerIndex].games.length;i++)if(query(e,i)){var a=getRowData(i);if(!t[a.year]){{var r=Ti.UI.createTableViewSection({index:i,count:0});Ti.UI.createView({height:1})}t[a.year]=r}t[a.year].add(a),t[a.year].count++}var n=t,o=[],h=0;for(i=0;i<s.length;i++)t[s[i]]&&(o.push({title:s[i],index:h}),h+=t[s[i]].count);return data={tableData:n,index:o}}function query(e,s){if(null==e||0==e.length)return!0;e=e.toLowerCase().replace(","," ").replace(";"," ");var t=myChess.Games[myChess.PlayerIndex].games[s],i=t.White,a=t.Black,r=t.Site,n=t.Year,o=t.Date,h=t.Event,c=t.ECO,d=i+" "+a;r&&(d+=" "+r),n&&(d+=" "+n),o&&(d+=" "+o),h&&(d+=" "+h),c&&(d+=" "+c),d=d.replace("?"," ").replace(","," "),d=d.toLowerCase();var b=e.split(" ");for(si=0;si<b.length;si++){var f=b[si];if(-1==d.indexOf(f))return!1}return!0}function getInitData(){var e=[];for(li=0;9>li;li++){var s=Ti.UI.createTableViewRow({backgroundColor:"#transparent",title:" ",font:{fontSize:18,fontWeight:"bold",fontFamily:"Arial"},color:"black"});e.push(s)}return e[5].title=" ... Loading game list ...",e}module.exports=MasterView;